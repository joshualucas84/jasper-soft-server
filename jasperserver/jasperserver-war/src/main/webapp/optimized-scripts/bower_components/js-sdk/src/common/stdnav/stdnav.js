define(["require","exports","module","jquery","underscore","logger"],function(t,e,n){"use strict";var i=t("jquery"),s=(t("underscore"),t("logger").register(n)),o=0,u=function(){o++,this.serial=o,this.menuItemCallbacks={click:{}},this.plugins={},this.modalDialogActive=!1,this.modalDialogRoot=null,this.debugElementID=null,this.chaffLength=1,this.maxChaffLength=8};i.extend(u.prototype,{_maxNavDepth:100,nullOrUndefined:function(t){return null===t||"undefined"==typeof t?!0:!1},closestAncestor:function(t,e,n,s){if(void 0===t||null===t)return void 0;for(var o=i(t).parent(),u=1;void 0!==o;){if(null!==s&&void 0!==s&&u>=s)return void 0;if(o.is(n))return void 0;if(o.is(e))return o;u++,o=o.parent()}return void 0},closestDescendant:function(t,e,n,s){if(null===t||void 0===t||null===e||void 0===e)return void 0;var o;o=null===s||void 0===s?this._maxNavDepth:s;for(var u=[],r=0,a=1,c=0,d=t;void 0!==d;){if(i(d).is(e)&&r>0)return d;if(!i(d).is(n)){var l=i(d).children();l.each(function(t,e){u.unshift(e),c++})}if(0===--a&&(r++,a=c,c=0),r>o)return void 0;d=u.pop()}return void 0},zinit:function(t){return s.debug("stdnav.init("+t+")\n"),this},navtype_nodeNames:{},updateDebugInfo:function(){if(this.debugElementID){var t=i("#"+this.debugElementID),e=i(".superfocus"),n=i(document.activeElement),s=i(".subfocus"),o="[sup:";t.length<1||(o+=e.length,o+=e.length>0?":"+e[0].nodeName+"#"+e[0].id:"?",o+=", foc:",o+=n.length,o+=n.length>0?":"+n[0].nodeName+"#"+n[0].id:"?",o+=", sub:",o+=s.length,o+=s.length>0?":"+s[0].nodeName+"#"+s[0].id:"?",e=i(this._priorSuperfocus),n=i(this._priorFocus),s=i(this._priorSubfocus),o+=" :: psup:",t.length<1||(o+=e.length,o+=e.length>0?":"+e[0].nodeName+"#"+e[0].id:"?",o+=", pfoc:",o+=n.length,o+=n.length>0?":"+n[0].nodeName+"#"+n[0].id:"?",o+=", psub:",o+=s.length,o+=s.length>0?":"+s[0].nodeName+"#"+s[0].id:"?",o+="]",t.text(o)))}},beginModalFocus:function(t){if(t){this.modalDialogActive===!0&&this.endModalFocus(this.modalDialogRoot);var e=i(t),n=i("body *").filter(function(){return!(i.contains(t,this)||e.is(this))});this.modalDialogActive=!0,this.modalDialogRoot=t,n.each(function(t,e){var n=i(e),s=n.attr("tabIndex");"undefined"==typeof s?(n.attr("js-nonmodal-tabindex","undefined"),n.attr("tabIndex","-1")):(n.attr("js-nonmodal-tabindex",s),n.attr("tabIndex","-1"))})}},endModalFocus:function(t){var e,n;t?(e=i(t),n=i("body *").filter(function(){return!(i.contains(e,this)||e.is(this))})):(e=i(),n=i("body *")),n.each(function(t,e){var n=i(e),s=n.attr("js-nonmodal-tabindex");"undefined"==typeof s||("undefined"===s?(n.removeAttr("js-nonmodal-tabindex"),n.removeAttr("tabIndex")):(n.removeAttr("js-nonmodal-tabindex"),n.attr("tabIndex",s)))}),this.modalDialogActive=!1,this.modalDialogRoot=null},isNavigable:function(t){return i(t).is(this._navigableFilter)&&!i(t).is(this._unnavigableFilter)?!0:!1},closestNavigableAncestor:function(t){return this.closestAncestor(t,this._navigableFilter,this._unnavigableFilter,this._maxNavDepth)},closestNavigableDescendant:function(t){return this.closestDescendant(t,this._navigableFilter,this._unnavigableFilter,this._maxNavDepth)},_rebuildNavigationFilters:function(){var t="";i.each(this.navtype_nodeNames,function(e,n){i.each(n,function(e,n){t+=n+","})}),t+="[js-navtype]",this._navigableFilter=t,this._unnavigableFilter='[js-stdnav="false"],[js-navtype="none"]'},registerPlugin:function(t,e){this.plugins[t]=e},unregisterPlugin:function(t){this.plugins[t].unload(),delete this.plugins[t]},registerNavtype:function(t,e,n){this.navtypeBehaviors[t.toLowerCase()]=e,this.navtype_nodeNames[t.toLowerCase()]=n,this._rebuildNavigationFilters()},unregisterNavtype:function(t,e){delete this.navtypeBehaviors[t.toLowerCase()],delete this.navtype_nodeNames[t.toLowerCase()],this._rebuildNavigationFilters()},activate:function(){this.nullBehavior={ariaprep:null,ariarefresh:null,click:null,down:null,end:null,enter:null,entered:null,exit:null,fixfocus:null,fixsubfocus:null,fixsuperfocus:null,focusin:null,focusout:null,home:null,hoverin:null,hoverout:null,inherit:null,inheritable:null,left:null,mousedown:null,mouseover:null,mouseout:null,mouseup:null,next:null,pagedown:null,pageup:null,prev:null,rejoined:null,right:null,subfocusin:null,subfocusout:null,superfocusin:null,superfocusout:null,toggle:null,touchend:null,touchstart:null,up:null},this.defaultBehavior={enter:[this,this.basicEnter,null],entered:[this,this.basicEntered,null],exit:[this,this.basicExit,null],fixfocus:[this,this.basicFixFocus,null],fixsubfocus:[this,this.basicFixSubfocus,null],fixsuperfocus:[this,this.basicFixSuperfocus,null],focusin:[this,this.basicFocusIn,{maxdepth:0}],focusout:[this,this.basicFocusOut,null],inherit:!0,inheritable:!0,rejoined:[this,this.basicRejoined,null],subfocusin:[this,this.basicSubfocusIn,null],subfocusout:[this,this.basicSubfocusOut,null],superfocusin:[this,this.basicSuperfocusIn,null],superfocusout:[this,this.basicSuperfocusOut,{ghostfocus:!1}]},this.navtypeBehaviors={block:{},global:{},inline:{},modal:{next:this._onModalNext,inherit:!1,inheritable:!0}},this._refocusing=!1,this._priorSuperfocus=null,this._priorFocus=null,this._priorSubfocus=null,this._currentSuperfocus=document.activeElement,this._currentFocus=document.activeElement,this._currentSubfocus=document.activeElement,i(this._currentSuperfocus).addClass("superfocus"),i(this._currentSubfocus).addClass("subfocus"),this._rebuildNavigationFilters(),this._bindFocusEvents(),this._bindKeyboardEvents(),this._bindMouseEvents(),this._bindTouchEvents()},start:function(){var t=i(".stdnavinitialfocus");t.length<1&&(document.activeElement&&document.activeElement!=i("body")[0]?t=i(document.activeElement):(t=i("body").children("[tabindex='0']:first"),t.length<1&&(t=i("body")))),this.forceFocus(i("body")[0]),i("#IECM").html("&nbsp;"),this._unforceFocus(i("body")[0]),i("body").blur(),i("#IECM").html("&nbsp;&nbsp;"),this.forceFocus(t[t.length-1]),i("body").attr("aria-busy",!1),i("#ariastatus").attr("aria-label","Standard Navigation initialized."),this.updateDebugInfo()},stop:function(){},deactivate:function(){this._unbindTouchEvents(),this._unbindMouseEvents(),this._unbindKeyboardEvents(),this._unbindFocusEvents()},_bindFocusEvents:function(){i("body").on("focusin",i.proxy(this._onFocusIn,this)),i("body").on("focusout",i.proxy(this._onFocusOut,this))},_bindKeyboardEvents:function(){i(document).on("keydown",i.proxy(this._onKeydown,this))},_bindMouseEvents:function(){i("body").on("click",i.proxy(this._onClick,this)),i("body").on("dblclick",i.proxy(this._onDblClick,this)),i("body").on("mousedown",i.proxy(this._onMouseDown,this)),i("body").on("mouseover",i.proxy(this._onMouseOut,this)),i("body").on("mouseout",i.proxy(this._onMouseOver,this)),i("body").on("mouseup",i.proxy(this._onMouseUp,this))},_bindTouchEvents:function(){i("body").on("touchend",i.proxy(this._onTouchStart,this)),i("body").on("touchstart",i.proxy(this._onTouchStart,this))},_unbindTouchEvents:function(){i("body").off("touchend",i.proxy(this._onTouchStart,this)),i("body").off("touchstart",i.proxy(this._onTouchStart,this))},_unbindMouseEvents:function(){i("body").off("click",i.proxy(this._onClick,this)),i("body").off("dblclick",i.proxy(this._onDblClick,this)),i("body").off("mousedown",i.proxy(this._onMouseDown,this)),i("body").off("mouseover",i.proxy(this._onMouseOut,this)),i("body").off("mouseout",i.proxy(this._onMouseOver,this)),i("body").off("mouseup",i.proxy(this._onMouseUp,this))},_unbindKeyboardEvents:function(){i(document).off("keydown",i.proxy(this._onKeydown,this))},_unbindFocusEvents:function(){i("body").off("focusin",i.proxy(this._onFocusIn,this)),i("body").off("focusout",i.proxy(this._onFocusOut,this))},_getExplicitBehavior:function(t){var e={};return void 0!==t.attr("js-stdanv-enter")&&(e.enter=t.attr("js-stdnav-enter")),void 0!==t.attr("js-stdanv-exit")&&(e.exit=t.attr("js-stdnav-exit")),void 0!==t.attr("js-stdanv-entered")&&(e.entered=t.attr("js-stdnav-entered")),void 0!==t.attr("js-stdanv-rejoin")&&(e.rejoin=t.attr("js-stdnav-rejoin")),void 0!==t.attr("js-stdanv-up")&&(e.up=t.attr("js-stdnav-up")),void 0!==t.attr("js-stdanv-down")&&(e.down=t.attr("js-stdnav-down")),void 0!==t.attr("js-stdanv-left")&&(e.left=t.attr("js-stdnav-left")),void 0!==t.attr("js-stdanv-right")&&(e.right=t.attr("js-stdnav-right")),void 0!==t.attr("js-stdanv-next")&&(e.next=t.attr("js-stdnav-next")),void 0!==t.attr("js-stdanv-prev")&&(e.prev=t.attr("js-stdnav-prev")),void 0!==t.attr("js-stdanv-inherit")&&(e.inherit=t.attr("js-stdnav-inherit")),void 0!==t.attr("js-stdanv-inheritable")&&(e.inheritable=t.attr("js-stdnav-inheritable")),e},_buildParentBehaviorOBSOLETE:function(t){var e=i(t.parent()[0]);if(void 0===e)return this.defaultBehavior;var n=this._buildImmediateBehavior(e);if(n.inheritable===!1)return this.defaultBehavior;if(n.inherit===!1||e.is("body,iframe"))return i.extend({},!0,this.defaultBehavior,n);var s=this._buildParentBehavior(e);return i.extend({},!0,s,n,{inherit:!1})},_buildBehavior:function(t){for(var e=i.extend(!0,{},this.nullBehavior),n=t,o=0,u=this._buildImmediateBehavior(n);o<this._maxNavDepth&&(i.each(u,function(t,n){t in e?null===e[t]&&(e[t]=n):(s.warn("StdNav: Key '"+t+"' is missing from the NULL-behavior hash"),e[t]=n)}),u.inherit!==!1)&&(o++,n=i(n).parent()[0],u=this._buildImmediateBehavior(n),u.inheritable!==!1););return i.each(this.defaultBehavior,function(t,n){t in e?null===e[t]&&(e[t]=n):(s.warn("StdNav: Key '"+t+"' is defined in defaults but missing from the NULL-behavior hash"),e[t]=n)}),i.extend(!0,{},e)},_buildImmediateBehavior:function(t){if(this.nullOrUndefined(t))return this.defaultBehavior;var e,n=i(t),s=n.prop("nodeName");i.each(this.navtype_nodeNames,function(t,n){i.inArray(s,n)>-1&&(e=t)});var o={};void 0!==e&&(o=this.navtypeBehaviors[e]);var u=n.attr("js-navtype"),r={};void 0!==u&&(r=this.navtypeBehaviors[u.toLowerCase()]);var a=this._getExplicitBehavior(n);return i.extend(!0,{inherit:!0},o,r,a)},_buildBehaviorOBSOLETE:function(t){if(void 0===t||null===t)return this.defaultBehavior;var e=i(t),n=this._buildImmediateBehavior(e),s={};return n.inherit===!0&&(s=this._buildParentBehavior(e)),i.extend(!0,s,n)},isLogicFocusable:function(t){if(this.nullOrUndefined(t))return s.error("isLogicFocusable called on a null or undefined element"),!1;var e=i(t),n=!1,o=e.prop("nodeName");e.attr("tabindex");return(e.is(":input")||i.inArray(o,["A","BUTTON","INPUT","SELECT","OBJECT","TEXTAREA"])>-1)&&e.is(":enabled")&&(n=!0),e.is("[tabindex]")&&(n=!0),n},isUserFocusable:function(t){if(this.nullOrUndefined(t))return s.error("isUserFocusable called on a null or undefined element"),!1;var e=i(t),n=!1,o=e.prop("nodeName"),u=e.attr("tabindex");return(e.is(":input")||i.inArray(o,["A","BUTTON","INPUT","SELECT","OBJECT","TEXTAREA"])>-1)&&e.is(":enabled")&&(n=!0),void 0!==u&&(n="-1"==u?!1:!0),n},suspendFocusability:function(t){if(this.nullOrUndefined(t))return void s.warn("stdnav.suspendFocusability called on null or undefined element");var e=i(t);if(!this.nullOrUndefined(e.attr("js-suspended-tabindex")))return void s.warn("stdnav.suspendFocusability called on already suspended element "+t.nodeType+"#"+t.id);var n=e.attr("tabindex");this.nullOrUndefined(n)?e.attr("js-suspended-tabindex","none"):e.attr("js-suspended-tabindex",n),e.attr("tabindex","-1")},resumeFocusability:function(t){if(this.nullOrUndefined(t))return void s.warn("stdnav.resumeFocusability called on null or undefined element");var e=i(t),n=e.attr("js-suspended-tabindex");return this.nullOrUndefined(n)?void s.warn("stdnav.resumeFocusability called on non-suspended element "+t.nodeName+"#"+t.id):("none"===n?e.removeAttr("tabindex"):e.attr("tabindex",n),void e.removeAttr("js-suspended-tabindex"))},ensureFocusabilityBeyond:function(t){var e=i("[suspended-tabindex]");e.each(function(e){if(!i.contains(e,t)){var n=i(e),s=n.attr("js-suspended-tabindex");n.attr("tabindex",s),n.removeAttr("js-suspended-tabindex")}})},forceFocus:function(t){s.debug("stdnav.forceFocus("+t.nodeName+"#"+t.id+")");var e=i(t),n=0;if(i.each(e.parents("[tabindex]"),function(t,e){var s=i(e);s.attr("tabindex")>n&&(n=s.attr("tabindex")),s.attr("js-suspended-tabindex")>n&&(n=s.attr("js-suspended-tabindex"))}),!e.is(i(document.activeElement))){if((!this.isLogicFocusable(t)||n>e.attr("tabindex"))&&!e.attr("priortabindex")){var o=e.attr("tabindex");void 0!==o?e.data("prior-tabindex",o):e.data("prior-tabindex","none"),e.attr("tabindex",n)}i(t).focus()}},_unforceFocus:function(t){var e=i(t),n=e.data("prior-tabindex");this.nullOrUndefined(n)||("none"==n?e.removeAttr("tabindex"):e.attr("tabindex",n),e.removeData("prior-tabindex"))},_onClick:function(t){var e=i(t.target);if(1==e.length){var n=this._buildBehavior(e);if(null!=n.click){var s=this.runAction("click",t.target);s===!1&&(t.stopPropagation(),t.preventDefault())}}},_onMouseDown:function(t){var e=i(t.target);if(1==e.length){var n=this._buildBehavior(e);if(null!=n.mousedown){var s=this.runAction("mousedown",t.target);s===!1&&(t.stopPropagation(),t.preventDefault())}}},_onMouseUp:function(t){var e=i(t.target);if(1==e.length){var n=this._buildBehavior(e);if(null!=n.mouseup){var s=this.runAction("mouseup",t.target);s===!1&&(t.stopPropagation(),t.preventDefault())}}},_onFocusIn:function(t){this._currentFocus=t.target;var e=null;s.info("stdnav._onFocusIn  ev.target=="+t.target.nodeName+"#"+t.target.id),this.updateDebugInfo();for(var n="",o=0;o<this.chaffLength;o++)n+="&nbsp;";if(i("#IECM").html(n),this.chaffLength=(this.chaffLength+1)%this.maxChaffLength,0===this.chaffLength&&(this.chaffLength=1),i(t.target).length<1)return void(this._refocusing=!1);var u=t.target;if(e=this.runAction("fixfocus",u),null===e&&(e=u),e!==u)this._refocusing=!0,this.forceFocus(e);else if(this._refocusing=!1,u===this._priorFocus);else{if(i(".subfocus").removeClass("subfocus"),this._priorSubfocus&&this.runAction("subfocusout",this._priorSubfocus),this._priorFocus&&(this.runAction("focusout",this._priorFocus),this._unforceFocus(this._priorFocus)),this._currentFocus=u,this._currentSuperfocus=this.runAction("fixsuperfocus",this._currentFocus),null===this._currentSuperfocus&&(this._currentSuperfocus=i("body")[0]),s.debug("stdnav._onFocusIn: fixsuperfocus("+this._currentFocus.nodeName+"#"+this._currentFocus.id+") returned "+this._currentSuperfocus.nodeName+"#"+this._currentSuperfocus.id),this._currentSuperfocus!==this._priorSuperfocus){var r=i(".superfocus");r.length>0?s.debug("Removing .superfocus from "+r[0].nodeName+"#"+r[0].id):s.warn("No current .superfocus to remove"),i(".superfocus").removeClass("superfocus"),this._priorSuperfocus&&(this.runAction("superfocusout",this._priorSuperfocus),this.resumeFocusability(this._priorSuperfocus)),s.debug("Running ARIA refresh for "+this._currentSuperfocus.nodeName+"#"+this._currentSuperfocus.id),this.runAction("ariarefresh",this._currentSuperfocus),s.debug("Adding .superfocus to "+this._currentSuperfocus.nodeName+"#"+this._currentSuperfocus.id),i(this._currentSuperfocus).addClass("superfocus"),i(this._currentSuperfocus).is(this._currentFocus)||this.suspendFocusability(this._currentSuperfocus),this.runAction("superfocusin",this._currentSuperfocus)}this._currentSubfocus=this.runAction("focusin",this._currentFocus),null===this._currentSubfocus&&(this._currentSubfocus=this._currentFocus),i(this._currentSubfocus).addClass("subfocus"),this.runAction("subfocusin",this._currentSubfocus),this.ensureFocusabilityBeyond(this._currentFocus)}this.updateDebugInfo()},_onFocusOut:function(t){this.updateDebugInfo(),this._refocusing===!0||(i(".superfocus").length>0?this._priorSuperfocus=i(".superfocus")[0]:(s.warn("no prior superfocus"),this._priorSuperfocus=i("body")[0]),this._priorFocus=t.target,i(".subfocus").length>0?this._priorSubfocus=i(".subfocus")[0]:(s.warn("no prior subfocus"),this._priorSubfocus=t.target)),this.updateDebugInfo()},_prepSubfocusIn:function(t){0===i(t).parents(":focus").length&&i(t).focus()},setSuperfocus:function(t,e){s.debug("stdnav.setSuperfocus("+t.nodeName+"#"+t.id+", "+e+")"),void 0===e&&(e=!0);var n=i(".subfocus");n.length>0&&(e&&this.runAction("subfocusout",n[0]),n.removeClass("subfocus")),i(t).addClass("subfocus"),e&&(this._prepSubfocusIn(t),this.runAction("subfocusin",t))},setSubfocus:function(t,e){s.debug("stdnav.setSubfocus("+t.nodeName+"#"+t.id+", "+e+")"),void 0===e&&(e=!0);var n=i(".subfocus");n.length>0&&(e&&this.runAction("subfocusout",n[0]),n.removeClass("subfocus")),i(t).addClass("subfocus"),e&&(this._prepSubfocusIn(t),this.runAction("subfocusin",t))},runAction:function(t,e){if(null===e)return void s.warn("tried to run action '"+t+"' on null element");if("undefined"==typeof e)return void s.warn("tried to run action '"+t+"' on undefined element");s.debug("stdnav.runAction("+t+", "+e.nodeName+"#"+e.id+")");var n=this._buildBehavior(e);return this.nullOrUndefined(n[t])?void 0:this._runActionDesc(n[t],e)},_runActionDesc:function(t,e){var n=!0;if("string"==typeof t||t instanceof String){if("#"==t.substr(0,1))if("##parent"==t)this.forceFocus(i(e).parent());else if("##child"==t){var o=i(e).children();o.length>0&&this.forceFocus(i(e).children()[0])}else if("##prev"==t){var u=i(e).prev();u.length>0&&this.forceFocus(i(e).prev()[0])}else if("##next"==t){var r=i(e).next();r.length>0&&this.forceFocus(i(e).next()[0])}else{var a=i(t);void 0!==a&&this.forceFocus(a)}else if("@"==t.substr(0,1)){var c,d,l,h,f,b,v=this;if("@"==t.substr(1,1))v=i(e).data("stdnav-context");else if(h=t.indexOf(":"),h>-1){var p=t.substr(0,h);v=this.actionContexts[p]}f=t.indexOf("("),-1==f?c=t.substr(2):(b=t.indexOf(")"),c=t.substr(2,f-2),-1==b?s.warn("Bad stdnav action: "+t):l=t.substr(f,b-f)),d=v[c],n=d.call(v,l)}}else if(t instanceof Array){void 0===t[1]&&s.warn("undefined actionDesc[1]");var v=t[0];(null===v||"undefined"==typeof v)&&(v=this);var g=t[1],m=t[2];(null===m||"undefined"==typeof m)&&(m={}),n=g.call(v,e,m)}return n},basicClick:function(t,e){var n=this.runAction("fixfocus",t);return this.nullOrUndefined(n)?s.debug("stdnav.basicClick: "+t.nodeName+"#"+t.id+" has no navigable ancestor, ignoring"):(s.debug("stdnav.basicClick("+t.nodeName+"#"+t.id+") refocusing to "+n.nodeName+"#"+n.id),this.nullOrUndefined(n)||this.forceFocus(n)),!0},basicFixFocus:function(t,e){if(this.isNavigable(t)||i(t).is(":input"))return t;var n=this.closestNavigableAncestor(t);return this.nullOrUndefined(n)?null:n},basicFixSuperfocus:function(t,e){var n=null;if(i(t).is(":input,fieldset")){var s=i(t).closest("form");i(t).closest("form"),s.length>0&&(n=s[0])}else n=this.isNavigable(t)?t:this.closestNavigableAncestor(t);return(null===n||"undefined"==typeof n)&&(n=t),n},parentFixSuperfocus:function(t,e){return this.basicFixSuperfocus(t.parentNode,e)},basicFixSubfocus:function(t,e){return t},basicFocusIn:function(t,e){return s.debug("stdnav.basicFocusIn("+t.nodeName+"#"+t.id+")"),t},basicFocusOut:function(t,e){return s.debug("stdnav.basicFocusOut("+t.nodeName+"#"+t.id+")"),null},basicMouseDown:function(t,e){var n=this.runAction("fixfocus",t);return this.nullOrUndefined(n)?s.debug("stdnav.basicClick: "+t.nodeName+"#"+t.id+" has no navigable ancestor, ignoring"):(s.debug("stdnav.basicClick("+t.nodeName+"#"+t.id+") refocusing to "+n.nodeName+"#"+n.id),this.nullOrUndefined(n)||this.forceFocus(n)),!0},basicMouseUp:function(t,e){return!0},basicSuperfocusIn:function(t,e){s.debug("stdnav.basicSuperfocusIn("+t.nodeName+"#"+t.id+")");var n=null;if("focusSelector"in e){var o=":input,fieldset,"+e.focusSelector+'[js-navigable!="false"]',u=null;"barrier"in e&&(u=e.barrier);var r=this._maxNavDepth;"maxdepth"in e&&(r=e.maxdepth),"ghostfocus"in e&&e.ghostfocus===!0&&(n=this.closestDescendant(t,o+" .ghostfocus",u,r),i(n).removeClass("ghostfocus")),null==n&&(n=this.closestDescendant(t,o,u,r))}return null==n&&(n=t),n},basicSuperfocusOut:function(t,e){return s.debug("stdnav.basicSuperfocusOut("+t.nodeName+"#"+t.id+")"),"ghostfocus"in e&&e.ghostfocus===!0&&this._priorFocus&&i(this._priorFocus).addClass("ghostfocus"),null},basicSubfocusIn:function(t,e){return s.debug("stdnav.basicSubfocusIn("+t.nodeName+"#"+t.id+")"),null},basicSubfocusOut:function(t,e){return s.debug("stdnav.basicSubfocusOut("+t.nodeName+"#"+t.id+")"),null},basicEnter:function(t,e){s.debug("stdnav.basicEnter("+t.nodeName+"#"+t.id+")");var n=this.closestNavigableDescendant(t);return void 0!==n&&this.runAction("entered",n),t},basicExit:function(t,e){s.debug("stdnav.basicExit("+t.nodeName+"#"+t.id+")");var n=this.closestNavigableAncestor(i(".superfocus"));return n||(n=i("#mainNavigation")),void 0!==n&&this.runAction("rejoined",n[0]),n[0]},basicEntered:function(t,e){s.debug("stdnav.basicEntered("+t.nodeName+"#"+t.id+")")},basicRejoined:function(t,e){s.debug("stdnav.basicRejoined("+t.nodeName+"#"+t.id+")")},_onKeydown:function(t){t.target;if(0!==i(".subfocus").length){var e=i(".subfocus")[0],n=!1,o=i(e).prop("nodeName");if(!(i(e).is(":input")||i.inArray(o,["INPUT","SELECT","OBJECT","TEXTAREA"])>-1)||"BUTTON"==o||27==t.keyCode){for(var u=i(e).parents(),r=0;r<u.length;r++)if(!this.nullOrUndefined(i(u[r]).attr("js-stdnav"))){n="true"==i(u[r]).attr("js-stdnav")?!0:!1;break}if(!n)return void s.warn("StdNav is disabled in this subdom, aborting action");var a;switch(t.keyCode){case 13:a="enter";break;case 27:a="exit";break;case 32:a="toggle";break;case 33:a="pageup";break;case 34:a="pagedown";break;case 35:a="end";break;case 36:a="home";break;case 37:a="left";break;case 38:a="up";break;case 39:a="right";break;case 40:a="down";break;case 91:a="structleft";break;case 93:a="structright"}if(!this.nullOrUndefined(a)){var c=this.runAction(a,e);this.nullOrUndefined(c)||(t.stopPropagation(),t.preventDefault(),this.forceFocus(c))}}}}});var r=new u;return r});