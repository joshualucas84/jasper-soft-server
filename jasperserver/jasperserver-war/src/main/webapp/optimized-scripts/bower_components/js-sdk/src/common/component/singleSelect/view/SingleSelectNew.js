define(["require","underscore","common/component/list/model/listWithNavigationModelTrait","common/component/singleSelect/view/SingleSelect","common/component/singleSelect/model/SingleSelectListModelNew"],function(e){"use strict";var t=e("underscore"),i=e("common/component/list/model/listWithNavigationModelTrait"),n=e("common/component/singleSelect/view/SingleSelect"),l=e("common/component/singleSelect/model/SingleSelectListModelNew"),o=function(e){for(var t=this.listViewModel.get("bufferStartIndex"),i=this.listViewModel.get("items"),n=0;n<i.length;n++)if(e===i[n].value)return t+n;return void 0},a=n.extend({initialize:function(e){o=t.bind(o,this),this.formatValue=e.formatValue,n.prototype.initialize.call(this,e)},_createListViewModel:function(e){this.getData=e.getData;var i=e.model||t.extend(new l(e),{_afterSelect:this._afterSelect});return i},_getGetData:function(){return this.getData},_afterSelect:function(e,t){if(e&&"string"==typeof e&&!this.getActive()){var n=o(e);"undefined"!=typeof n&&i.setActive.call(this,{index:n,item:{value:e},silent:!0})}},_getActiveValueIndex:function(e){return o(e.value)},changeFilter:function(){var e=this;this.listView.scrollTo(0),this._getGetData()({criteria:this.model.get("criteria"),offset:0,limit:1}).done(function(){e.listView.fetch(function(){e.listView.resize(),e.setValueToList()})})},getControlLabelByValue:function(e){return null==e.label?this.formatValue?this.formatValue(e.value):e.value:e.label},setValue:function(e,t){var e=this.convertExternalValueToInternalFormat(e);t&&t.silent&&(this.silent=!0),this.model.set("value",e),this.setValueToList(t)},setValueToList:function(e){var t=this.model.get("value"),i={};t&&t.index?i[t.index]=t.value:t&&(i=t.value),this.listView.setValue(i,e)}});return a});