define(["require","backbone","underscore","./OptionView"],function(t){"use strict";function e(t){if(!t)throw new Error("Init options must be specified");if(!t.options||!t.options.length)throw new Error("Option views descriptors must be specified");if(!t.mainTemplate&&!t.el)throw new Error("Option container must have a template");if(!t.optionTemplate)throw new Error("Option container must have an option template")}var i=t("backbone"),o=t("underscore"),n=t("./OptionView"),s=Array.prototype.slice;return i.View.extend({el:function(){return o.template(this.template)()},constructor:function(t){e(t),this.contextName=t.contextName||"option",this.contentContainer=t.el?t.contentContainer:t.contentContainer||"> .content > ul",this.toggle=!!t.toggle,this.toggleClass=t.toggleClass||"active",this.options=[],this.collection=new i.Collection(t.options),this.hasGroups=this.collection.models[0]&&this.collection.models[0].get("groupId")?!0:!1,this.defalutOptionView=this.hasGroups?this.collection.where({"default":!0}):[this.collection.findWhere({"default":!0})],this.listenTo(this.collection,"select",this._selectOption),this.template=t.mainTemplate,this.optionTemplate=t.optionTemplate,i.View.apply(this,arguments)},setElement:function(t){var e=i.View.prototype.setElement.apply(this,arguments);return this.$contentContainer=this.contentContainer?this.$(this.contentContainer):this.$el,e},initialize:function(){var t=this;this.collection.forEach(function(e){var i=new n({template:t.optionTemplate,model:e,toggleClass:t.toggleClass});t.listenTo(i,"mouseover",function(e,i,o){t.trigger("mouseover",e,t,o)}),t.listenTo(i,"mouseout",function(e,i,o){t.trigger("mouseout",e,t,o)}),t.options.push(i),t.$contentContainer.append(i.$el)}),this.toggle&&this.defalutOptionView&&o.each(this.defalutOptionView,function(t){t&&this.getOptionView(t.get("action")).addSelection()},this)},_onKeyDown:function(t){var e=this.getOptionView(t.keyCode,"triggerOnKeyCode");e&&!e.isDisabled()&&e.select()},_selectOption:function(t,e){if(this.toggle){var i=e.get("groupId"),n=this.hasGroups?o.where(this.options,function(t){return t.model.get("groupId")===i}):this.options;o.each(n,function(t){t.removeSelection()},this),t.addSelection()}this.trigger("selectionMade"),this.trigger(this.contextName+":"+e.get("action"),t,e)},getOptionView:function(t,e){return o.find(this.options,function(i){return i.model.get(e||"action")===t})},resetSelection:function(t,e){t=t||[],this.toggle&&(this.hasGroups?(t.length<this.defalutOptionView.length&&o.each(this.defalutOptionView,function(e){var i={groupId:e.get("groupId")},n=o.findWhere(t,i);!n&&e&&t.push(o.extend(i,{action:e.get("action")}))}),t=o.pluck(t,"action")):!t.length&&this.defalutOptionView[0]&&t.push(this.defalutOptionView[0].get("action")),o.each(this.options,function(i){t.length&&(o.contains(t,i.model.get("action"))?e?this._selectOption(i,i.model):i.addSelection():i.removeSelection())},this))},select:function(){var t=Array.prototype.slice.call(arguments,0);this.toggle&&o.each(this.options,function(e){!t.length||o.contains(t,e.model.get("action"))?e.addSelection():e.removeSelection()},this)},deselect:function(){var t=Array.prototype.slice.call(arguments,0);this.toggle&&o.each(this.options,function(e){(!t.length||o.contains(t,e.model.get("action")))&&e.removeSelection()},this)},show:function(){return o.each(this.options,function(t){var e=t.model.get("test");e&&!e()?t.hide():t[t.model.get("hidden")?"hide":"show"]()}),this.$el.show(),this.trigger("show",this),this},hide:function(){return this.$el.hide(),this.trigger("hide",this),this},enable:function(){var t=s.call(arguments);o.each(this.options,function(e){(!t.length||o.contains(t,e.model.get("action")))&&e.enable()})},disable:function(){var t=s.call(arguments);o.each(this.options,function(e){(!t.length||o.contains(t,e.model.get("action")))&&e.disable()})},remove:function(){o.invoke(this.options,"remove"),i.View.prototype.remove.apply(this,arguments)}})});